!function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){var e,t,n="object",r="undefined",i=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],o=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],a=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],s=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function c(e,t){var r=typeof e[t];return"function"==r||!!(r==n&&e[t])||"unknown"==r}function l(e,t){return!!(typeof e[t]==n&&e[t])}function f(e,t){return typeof e[t]!=r}function u(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}var d=u(c),h=u(l),g=u(f);function p(e){return e&&d(e,s)&&g(e,a)}function m(e){return l(e,"body")?e.body:e.getElementsByTagName("body")[0]}var v={},R=typeof window!=r&&typeof document!=r,C={isHostMethod:c,isHostObject:l,isHostProperty:f,areHostMethods:d,areHostObjects:h,areHostProperties:g,isTextRange:p,getBody:m,forEach:[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;n<r;++n)t(e[n],n)}},N={version:"1.3.1",initialized:!1,isBrowser:R,supported:!0,util:C,features:{},modules:v,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==r||rangyAutoInitialize}};function E(e){typeof console!=r&&c(console,"log")&&console.log(e)}function y(e,t){R&&t?alert(e):E(e)}function $(e){N.initialized=!0,N.supported=!1,y("Rangy is not supported in this environment. Reason: "+e,N.config.alertOnFail)}N.fail=$,N.warn=function e(t){y("Rangy warning: "+t,N.config.alertOnWarn)},({}).hasOwnProperty?(C.extend=e=function(t,n,r){var i,o;for(var a in n)"__proto__"!==a&&"constructor"!==a&&"prototype"!==a&&n.hasOwnProperty(a)&&(i=t[a],o=n[a],r&&null!==i&&"object"==typeof i&&null!==o&&"object"==typeof o&&e(i,o,!0),t[a]=o);return n.hasOwnProperty("toString")&&(t.toString=n.toString),t},C.createOptions=function(t,n){var r={};return e(r,n),t&&e(r,t),r}):$("hasOwnProperty not supported"),R||$("Rangy can only run in a browser"),function(){var e;if(R){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(r){}}e||(e=function(e){for(var t=[],n=0,r=e.length;n<r;++n)t[n]=e[n];return t}),C.toArray=e}(),R&&(c(document,"addEventListener")?t=function(e,t,n){e.addEventListener(t,n,!1)}:c(document,"attachEvent")?t=function(e,t,n){e.attachEvent("on"+t,n)}:$("Document does not have required addEventListener or attachEvent method"),C.addListener=t);var T=[];function S(e){return e.message||e.description||String(e)}function w(){if(R&&!N.initialized){var e,t,n,r=!1,a=!1;c(document,"createRange")&&d(e=document.createRange(),o)&&g(e,i)&&(r=!0);var s=m(document);if(!s||"body"!=s.nodeName.toLowerCase()){$("No body element found");return}if(s&&c(s,"createTextRange")&&p(e=s.createTextRange())&&(a=!0),!r&&!a){$("Neither Range nor TextRange are available");return}for(var l in N.initialized=!0,N.features={implementsDomRange:r,implementsTextRange:a},v)(t=v[l])instanceof x&&t.init(t,N);for(var f=0,u=T.length;f<u;++f)try{T[f](N)}catch(h){n="Rangy init listener threw an exception. Continuing. Detail: "+S(h),E(n)}}}function _(e,t,n){n&&(e+=" in module "+n.name),N.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function A(e,t,n,r){e[t]=function(){return _(t,n,r),e[n].apply(e,C.toArray(arguments))}}C.deprecationNotice=_,C.createAliasForDeprecatedMethod=A,N.init=w,N.addInitListener=function(e){N.initialized?e(N):T.push(e)};var O=[];function x(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function b(e,t,n){var r=new x(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(N,t),t.supported=!0}catch(r){var i="Module '"+e+"' failed to load: "+S(r);E(i),r.stack&&E(r.stack)}}});return v[e]=r,r}function D(){}N.addShimListener=function(e){O.push(e)},R&&(N.shim=N.createMissingNativeApi=function e(t){t=t||window,w();for(var n=0,r=O.length;n<r;++n)O[n](t)},A(N,"createMissingNativeApi","shim")),x.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,i=n.length;r<i;++r){if(!(e=v[t=n[r]])||!(e instanceof x))throw Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,Error(e)},warn:function(e){N.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){N.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return Error("Error in Rangy "+this.name+" module: "+e)}},N.createModule=function(e){2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var t,n,r=b(e,n,t);N.initialized&&N.supported&&r.init()},N.createCoreModule=function(e,t,n){b(e,t,n)},N.RangePrototype=D,N.rangePrototype=new D,N.selectionPrototype=new function e(){},N.createCoreModule("DomUtil",[],function(e,t){var n,r,i,o="undefined",a=e.util,s=a.getBody;a.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),a.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var c=document.createElement("div");a.areHostMethods(c,["insertBefore","appendChild","cloneNode"])||t.fail("Incomplete Element implementation"),a.isHostProperty(c,"innerHTML")||t.fail("Element is missing innerHTML property");var l=document.createTextNode("test");a.areHostMethods(l,["splitText","deleteData","insertData","appendData","cloneNode"])||t.fail("Incomplete Text Node implementation");var f=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};function u(e){for(var t=0;e=e.previousSibling;)++t;return t}function d(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(f(r,n))return n;return null}function h(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function g(e,t,n){for(var r,i=n?e:e.parentNode;i;){if((r=i.parentNode)===t)return i;i=r}return null}function p(e){var t=e.nodeType;return 3==t||4==t||8==t}function m(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function v(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=o)return e.ownerDocument;if(typeof e.document!=o)return e.document;if(e.parentNode)return v(e.parentNode);throw t.createError("getDocument: no document found for node")}function R(e){var n=v(e);if(typeof n.defaultView!=o)return n.defaultView;if(typeof n.parentWindow!=o)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function C(e){if(typeof e.contentDocument!=o)return e.contentDocument;if(typeof e.contentWindow!=o)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function N(e){return e&&a.isHostMethod(e,"setTimeout")&&a.isHostObject(e,"document")}var E=!1;function y(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function $(e){if(!e)return"[No node]";if(E&&y(e))return"[Broken node]";if(p(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+u(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function T(e){this.root=e,this._next=e}function S(e,t){this.node=e,this.offset=t}function w(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}(n=document.createElement("b")).innerHTML="1",r=n.firstChild,n.innerHTML="<br />",E=y(r),e.features.crashyTextNodes=E,typeof window.getComputedStyle!=o?i=function(e,t){return R(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=o?i=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),T.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current){if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}}return this._current},detach:function(){this._current=this._next=this.root=null}},S.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+$(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},w.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},w.prototype.toString=function(){return this.message},e.dom={arrayContains:f,isHtmlNamespace:function e(t){var n;return typeof t.namespaceURI==o||null===(n=t.namespaceURI)||"http://www.w3.org/1999/xhtml"==n},parentElement:function e(t){var n=t.parentNode;return 1==n.nodeType?n:null},getNodeIndex:u,getNodeLength:function e(t){switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}},getCommonAncestor:d,isAncestorOf:h,isOrIsAncestorOf:function e(t,n){return h(t,n,!0)},getClosestAncestorIn:g,isCharacterDataNode:p,isTextOrCommentNode:function e(t){if(!t)return!1;var n=t.nodeType;return 3==n||8==n},insertAfter:m,splitDataNode:function e(t,n,r){var i=t.cloneNode(!1);if(i.deleteData(0,n),t.deleteData(n,t.length-n),m(i,t),r)for(var o,a=0;o=r[a++];)o.node==t&&o.offset>n?(o.node=i,o.offset-=n):o.node==t.parentNode&&o.offset>u(t)&&++o.offset;return i},getDocument:v,getWindow:R,getIframeWindow:function e(n){if(typeof n.contentWindow!=o)return n.contentWindow;if(typeof n.contentDocument!=o)return n.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")},getIframeDocument:C,getBody:s,isWindow:N,getContentDocument:function e(t,n,r){var i;if(t?a.isHostProperty(t,"nodeType")?i=1==t.nodeType&&"iframe"==t.tagName.toLowerCase()?C(t):v(t):N(t)&&(i=t.document):i=document,!i)throw n.createError(r+"(): Parameter must be a Window object or DOM node");return i},getRootContainer:function e(t){for(var n;n=t.parentNode;)t=n;return t},comparePoints:function e(n,r,i,o){var a,s,c,l,f;if(n==i)return r===o?0:r<o?-1:1;if(a=g(i,n,!0))return r<=u(a)?-1:1;if(a=g(n,i,!0))return u(a)<o?-1:1;if(!(s=d(n,i)))throw Error("comparePoints error: nodes have no common ancestor");if((c=n===s?s:g(n,s,!0))===(l=i===s?s:g(i,s,!0)))throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(f=s.firstChild;f;){if(f===c)return -1;if(f===l)return 1;f=f.nextSibling}},isBrokenNode:y,inspectNode:$,getComputedStyleProperty:i,createTestElement:function e(t,n,r){var i=s(t),o=t.createElement("div");o.contentEditable=""+!!r,n&&(o.innerHTML=n);var a=i.firstChild;return a?i.insertBefore(o,a):i.appendChild(o),o},removeNode:function e(t){return t.parentNode.removeChild(t)},fragmentFromNodeChildren:function e(t){for(var n,r=v(t).createDocumentFragment();n=t.firstChild;)r.appendChild(n);return r},createIterator:function e(t){return new T(t)},DomPosition:S},e.DOMException=w}),N.createCoreModule("DomRange",["DomUtil"],function(e,t){var n=e.dom,r=e.util,i=n.DomPosition,o=e.DOMException,a=n.isCharacterDataNode,s=n.getNodeIndex,c=n.isOrIsAncestorOf,l=n.getDocument,f=n.comparePoints,u=n.splitDataNode,d=n.getClosestAncestorIn,h=n.getNodeLength,g=n.arrayContains,p=n.getRootContainer,m=e.features.crashyTextNodes,v=n.removeNode;function R(e,t){return 3!=e.nodeType&&(c(e,t.startContainer)||c(e,t.endContainer))}function C(e){return e.document||l(e.startContainer)}function N(e){return new i(e.parentNode,s(e))}function E(e){return new i(e.parentNode,s(e)+1)}function y(e,t,r){var i=11==e.nodeType?e.firstChild:e;return a(t)?r==t.length?n.insertAfter(e,t):t.parentNode.insertBefore(e,0==r?t:u(t,r)):r>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[r]),i}function $(e,t,n){if(U(e),U(t),C(t)!=C(e))throw new o("WRONG_DOCUMENT_ERR");var r=f(e.startContainer,e.startOffset,t.endContainer,t.endOffset),i=f(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?r<=0&&i>=0:r<0&&i>0}function T(e,t,r){var i,o,a,s;for(r=r||{stop:!1};a=e.next();)if(e.isPartiallySelectedSubtree()){if(!1===t(a)){r.stop=!0;return}if(T(s=e.getSubtreeIterator(),t,r),s.detach(),r.stop)return}else for(i=n.createIterator(a);o=i.next();)if(!1===t(o)){r.stop=!0;return}}function S(e){return"["+(void 0===e.getName?"Range":e.getName())+"("+n.inspectNode(e.startContainer)+":"+e.startOffset+", "+n.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function w(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&a(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||a(this.sc)?d(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||a(this.ec)?d(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}w.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,a(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;a(n)&&(n===this.sc||n===this.ec)?(e=n===this.sc?this.so:0)!=(t=n===this.ec?this.eo:n.length)&&n.deleteData(e,t-e):n.parentNode&&v(n)},isPartiallySelectedSubtree:function(){return R(this._current,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)(e=this.range.cloneRange()).collapse(!1);else{e=new er(C(this.range));var t=this._current,n=t,r=0,i=t,o=h(t);c(t,this.sc)&&(n=this.sc,r=this.so),c(t,this.ec)&&(i=this.ec,o=this.eo),en(e,n,r,i,o)}return new w(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var _=[1,3,4,5,7,8,10],A=[2,9,11],O=[1,3,4,5,7,8,10,11],x=[1,3,4,5,7,8];function b(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){if(g(e,r=i.nodeType))return i;i=i.parentNode}return null}}var D=b([9,11]),P=b([5,6,10,12]),I=b([6,10,12]),H=b([1]);function B(e,t){if(I(e,t))throw new o("INVALID_NODE_TYPE_ERR")}function M(e,t){if(!g(t,e.nodeType))throw new o("INVALID_NODE_TYPE_ERR")}function W(e,t){if(t<0||t>(a(e)?e.length:e.childNodes.length))throw new o("INDEX_SIZE_ERR")}function L(e,t){if(D(e,!0)!==D(t,!0))throw new o("WRONG_DOCUMENT_ERR")}function k(e){if(P(e,!0))throw new o("NO_MODIFICATION_ALLOWED_ERR")}function F(e,t){if(!e)throw new o(t)}function j(e,t){return t<=(a(e)?e.length:e.childNodes.length)}function z(e){return!!e.startContainer&&!!e.endContainer&&!(m&&(n.isBrokenNode(e.startContainer)||n.isBrokenNode(e.endContainer)))&&p(e.startContainer)==p(e.endContainer)&&j(e.startContainer,e.startOffset)&&j(e.endContainer,e.endOffset)}function U(e){if(!z(e))throw Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}var V=document.createElement("style"),q=!1;try{V.innerHTML="<b>x</b>",q=3==V.firstChild.nodeType}catch(Y){}e.features.htmlParsingConforms=q;var Q=q?function(e){var t=this.startContainer,r=l(t);if(!t)throw new o("INVALID_STATE_ERR");var i=null;return 1==t.nodeType?i=t:a(t)&&(i=n.parentElement(t)),(i=null===i||"HTML"==i.nodeName&&n.isHtmlNamespace(l(i).documentElement)&&n.isHtmlNamespace(i)?r.createElement("body"):i.cloneNode(!1)).innerHTML=e,n.fragmentFromNodeChildren(i)}:function(e){var t=C(this).createElement("body");return t.innerHTML=e,n.fragmentFromNodeChildren(t)};function G(e,t){U(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,o=e.endOffset,c=n===i;a(i)&&o>0&&o<i.length&&u(i,o,t),a(n)&&r>0&&r<n.length&&(n=u(n,r,t),c?(o-=r,i=n):i==n.parentNode&&o>=s(n)&&o++,r=0),e.setStartAndEnd(n,r,i,o)}function X(e){U(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}var Z=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];function J(e){e.START_TO_START=0,e.START_TO_END=1,e.END_TO_END=2,e.END_TO_START=3,e.NODE_BEFORE=0,e.NODE_AFTER=1,e.NODE_BEFORE_AND_AFTER=2,e.NODE_INSIDE=3}function K(e){J(e),J(e.prototype)}function ee(e,t){return function(){U(this);var n,r,i=this.startContainer,o=this.startOffset,a=this.commonAncestorContainer,s=new w(this,!0);i!==a&&(i=(r=E(n=d(i,a,!0))).node,o=r.offset),T(s,k),s.reset();var c=e(s);return s.detach(),t(this,i,o,i,o),c}}function et(t,n){function i(e,t){return function(n){M(n,_),M(p(n),A);var r=(e?N:E)(n);(t?c:l)(this,r.node,r.offset)}}function c(e,t,r){var i=e.endContainer,o=e.endOffset;(t!==e.startContainer||r!==e.startOffset)&&((p(t)!=p(i)||1==f(t,r,i,o))&&(i=t,o=r),n(e,t,r,i,o))}function l(e,t,r){var i=e.startContainer,o=e.startOffset;(t!==e.endContainer||r!==e.endOffset)&&((p(t)!=p(i)||-1==f(t,r,i,o))&&(i=t,o=r),n(e,i,o,t,r))}var u=function(){};u.prototype=e.rangePrototype,t.prototype=new u,r.extend(t.prototype,{setStart:function(e,t){B(e,!0),W(e,t),c(this,e,t)},setEnd:function(e,t){B(e,!0),W(e,t),l(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],r=e[1],i=t,o=r;switch(e.length){case 3:o=e[2];break;case 4:i=e[2],o=e[3]}B(t,!0),W(t,r),B(i,!0),W(i,o),n(this,t,r,i,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){U(this),e?n(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):n(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){B(e,!0),n(this,e,0,e,h(e))},selectNode:function(e){B(e,!1),M(e,_);var t=N(e),r=E(e);n(this,t.node,t.offset,r.node,r.offset)},extractContents:ee(function e(t){for(var n,r,i=C(t.range).createDocumentFragment();n=t.next();){if(t.isPartiallySelectedSubtree()?(n=n.cloneNode(!1),r=t.getSubtreeIterator(),n.appendChild(e(r)),r.detach()):t.remove(),10==n.nodeType)throw new o("HIERARCHY_REQUEST_ERR");i.appendChild(n)}return i},n),deleteContents:ee(function e(t){for(var n;t.next();)t.isPartiallySelectedSubtree()?(e(n=t.getSubtreeIterator()),n.detach()):t.remove()},n),canSurroundContents:function(){U(this),k(this.startContainer),k(this.endContainer);var e=new w(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},splitBoundaries:function(){G(this)},splitBoundariesPreservingPositions:function(e){G(this,e)},normalizeBoundaries:function(){U(this);var e,t=this.startContainer,r=this.startOffset,i=this.endContainer,o=this.endOffset,c=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,o=e.length,e.appendData(t.data),v(t))},l=function(e){var n=e.previousSibling;if(n&&n.nodeType==e.nodeType){t=e;var a=e.length;if(r=n.length,e.insertData(0,n.data),v(n),t==i)o+=r,i=t;else if(i==e.parentNode){var c=s(e);o==c?(i=e,o=a):o>c&&o--}}},f=!0;if(a(i))o==i.length?c(i):0==o&&(e=i.previousSibling)&&e.nodeType==i.nodeType&&(o=e.length,t==i&&(f=!1),e.appendData(i.data),v(i),i=e);else{if(o>0){var u=i.childNodes[o-1];u&&a(u)&&c(u)}f=!this.collapsed}if(f){if(a(t))0==r?l(t):r==t.length&&(e=t.nextSibling)&&e.nodeType==t.nodeType&&(i==e&&(i=t,o+=t.length),t.appendData(e.data),v(e));else if(r<t.childNodes.length){var d=t.childNodes[r];d&&a(d)&&l(d)}}else t=i,r=o;n(this,t,r,i,o)},collapseToPoint:function(e,t){B(e,!0),W(e,t),this.setStartAndEnd(e,t)},parentElement:function(){return U(this),this.commonAncestorContainer?H(this.commonAncestorContainer,!0):null}}),K(t)}function en(e,t,r,i,o){var a;e.startContainer=t,e.startOffset=r,e.endContainer=i,e.endOffset=o,e.document=n.getDocument(t),(a=e).collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset,a.commonAncestorContainer=a.collapsed?a.startContainer:n.getCommonAncestor(a.startContainer,a.endContainer)}function er(e){en(this,e,0,e,0)}r.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){U(this),L(this.startContainer,t.startContainer);var n,r,i,o,a=3==e||0==e?"start":"end",s=1==e||0==e?"start":"end";return n=this[a+"Container"],r=this[a+"Offset"],f(n,r,i=t[s+"Container"],o=t[s+"Offset"])},insertNode:function(e){if(U(this),M(e,O),k(this.startContainer),c(e,this.startContainer))throw new o("HIERARCHY_REQUEST_ERR");var t=y(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){if(U(this),this.collapsed)return C(this).createDocumentFragment();if(this.startContainer===this.endContainer&&a(this.startContainer))return(e=this.startContainer.cloneNode(!0)).data=e.data.slice(this.startOffset,this.endOffset),(t=C(this).createDocumentFragment()).appendChild(e),t;var e,t,n=new w(this,!0);return e=function e(t){for(var n,r,i,a=C(t.range).createDocumentFragment();r=t.next();){if(n=t.isPartiallySelectedSubtree(),r=r.cloneNode(!n),n&&(i=t.getSubtreeIterator(),r.appendChild(e(i)),i.detach()),10==r.nodeType)throw new o("HIERARCHY_REQUEST_ERR");a.appendChild(r)}return a}(n),n.detach(),e},canSurroundContents:function(){U(this),k(this.startContainer),k(this.endContainer);var e=new w(this,!0),t=e._first&&R(e._first,this)||e._last&&R(e._last,this);return e.detach(),!t},surroundContents:function(e){if(M(e,x),!this.canSurroundContents())throw new o("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);y(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){U(this);for(var e,t=new er(C(this)),n=Z.length;n--;)t[e=Z[n]]=this[e];return t},toString:function(){U(this);var e=this.startContainer;if(e===this.endContainer&&a(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new w(this,!0);return T(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){U(this);var t=e.parentNode,n=s(e);if(!t)throw new o("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return r<0?i>0?2:0:i>0?1:3},comparePoint:function(e,t){return(U(this),F(e,"HIERARCHY_REQUEST_ERR"),L(e,this.startContainer),0>f(e,t,this.startContainer,this.startOffset))?-1:f(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:Q,toHtml:function(){return X(this)},intersectsNode:function(e,t){if(U(this),p(e)!=(n=this,p(n.startContainer)))return!1;var n,r=e.parentNode,i=s(e);if(!r)return!0;var o=f(r,i,this.endContainer,this.endOffset),a=f(r,i+1,this.startContainer,this.startOffset);return t?o<=0&&a>=0:o<0&&a>0},isPointInRange:function(e,t){return U(this),F(e,"HIERARCHY_REQUEST_ERR"),L(e,this.startContainer),f(e,t,this.startContainer,this.startOffset)>=0&&0>=f(e,t,this.endContainer,this.endOffset)},intersectsRange:function(e){return $(this,e,!1)},intersectsOrTouchesRange:function(e){return $(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=f(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=f(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return -1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return -1==f(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==f(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new o("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):3==this.compareNode(e)},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&0>=this.comparePoint(e,h(e))},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(!(n.length>0))return this.containsNodeContents(e);t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)},getNodes:function(e,t){var n,r,i,o,s,c,l;return U(this),n=this,r=e,i=t,s=!!(r&&r.length),c=!!i,s&&(o=RegExp("^("+r.join("|")+")$")),l=[],T(new w(n,!1),function(e){if((!s||o.test(e.nodeType))&&(!c||i(e))){var t=n.startContainer;if(!(e==t&&a(t))||n.startOffset!=t.length){var r=n.endContainer;(!(e==r&&a(r))||0!=n.endOffset)&&l.push(e)}}}),l},getDocument:function(){return C(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var r=C(this),i=e.createRange(r);t=t||n.getBody(r),i.selectNodeContents(t);var o=this.intersection(i),a=0,s=0;return o&&(i.setEnd(o.startContainer,o.startOffset),s=(a=i.toString().length)+o.toString().length),{start:a,end:s,containerNode:t}},moveToBookmark:function(e){var t,n,r,i=e.containerNode,o=0;this.setStart(i,0),this.collapse(!0);for(var a,s=[i],c=!1,l=!1;!l&&(a=s.pop());)if(3==a.nodeType)t=o+a.length,!c&&e.start>=o&&e.start<=t&&(this.setStart(a,e.start-o),c=!0),c&&e.end>=o&&e.end<=t&&(this.setEnd(a,e.end-o),l=!0),o=t;else for(n=(r=a.childNodes).length;n--;)s.push(r[n])},getName:function(){return"DomRange"},equals:function(e){return er.rangesEqual(this,e)},isValid:function(){return z(this)},inspect:function(){return S(this)},detach:function(){}}),et(er,en),r.extend(er,{rangeProperties:Z,RangeIterator:w,copyComparisonConstants:K,createPrototypeRange:et,inspect:S,toHtml:X,getRangeDocument:C,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=er}),N.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,i=e.dom,o=e.util,a=i.DomPosition,s=e.DomRange,c=i.getBody,l=i.getContentDocument,f=i.isCharacterDataNode;if(e.features.implementsDomRange&&function(){var r,a,f=s.rangeProperties;function u(e){for(var t,n=f.length;n--;)e[t=f[n]]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,u(this)},s.createPrototypeRange(n,function e(t,n,r,i,o){var a=t.startContainer!==n||t.startOffset!=r,s=t.endContainer!==i||t.endOffset!=o,c=!t.equals(t.nativeRange);(a||s||c)&&(t.setEnd(i,o),t.setStart(n,r))}),(r=n.prototype).selectNode=function(e){this.nativeRange.selectNode(e),u(this)},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),u(this)},r.collapse=function(e){this.nativeRange.collapse(e),u(this)},r.cloneRange=function(){return new n(this.nativeRange.cloneRange())},r.refresh=function(){u(this)},r.toString=function(){return this.nativeRange.toString()};var d=document.createTextNode("test");c(document).appendChild(d);var h=document.createRange();h.setStart(d,0),h.setEnd(d,0);try{h.setStart(d,1),r.setStart=function(e,t){this.nativeRange.setStart(e,t),u(this)},r.setEnd=function(e,t){this.nativeRange.setEnd(e,t),u(this)},a=function(e){return function(t){this.nativeRange[e](t),u(this)}}}catch(g){r.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}u(this)},r.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}u(this)},a=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(r){this.nativeRange[t](n),this.nativeRange[e](n)}u(this)}}}r.setStartBefore=a("setStartBefore","setEndBefore"),r.setStartAfter=a("setStartAfter","setEndAfter"),r.setEndBefore=a("setEndBefore","setStartBefore"),r.setEndAfter=a("setEndAfter","setStartAfter"),r.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},h.selectNodeContents(d),h.setEnd(d,3);var p=document.createRange();p.selectNodeContents(d),p.setEnd(d,4),p.setStart(d,2),-1==h.compareBoundaryPoints(h.START_TO_END,p)&&1==h.compareBoundaryPoints(h.END_TO_START,p)?r.compareBoundaryPoints=function(e,t){return e==(t=t.nativeRange||t).START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:r.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var m=document.createElement("div");m.innerHTML="123";var v=m.firstChild,R=c(document);R.appendChild(m),h.setStart(v,1),h.setEnd(v,2),h.deleteContents(),"13"==v.data&&(r.deleteContents=function(){this.nativeRange.deleteContents(),u(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return u(this),e}),R.removeChild(m),R=null,o.isHostMethod(h,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(d),r.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return(e=l(e,t,"createNativeRange")).createRange()}}(),e.features.implementsTextRange){var u=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();(n=e.duplicate()).collapse(!1);var o=n.parentElement(),a=r==o?r:i.getCommonAncestor(r,o);return a==t?a:i.getCommonAncestor(t,a)},d=function(e,t,n,r,o){var s=e.duplicate();s.collapse(n);var c=s.parentElement();if(i.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var l=new a(c.parentNode,i.getNodeIndex(c));return{boundaryPosition:l,nodeInfo:{nodeIndex:l.offset,containerElement:l.node}}}var u=i.getDocument(c).createElement("span");u.parentNode&&i.removeNode(u);for(var d,h=n?"StartToStart":"StartToEnd",g=o&&o.containerElement==c?o.nodeIndex:0,p=c.childNodes.length,m=p,v=m;v==p?c.appendChild(u):c.insertBefore(u,c.childNodes[v]),s.moveToElementText(u),0!=(d=s.compareEndPoints(h,e))&&g!=m;){if(-1==d){if(m==g+1)break;g=v}else m=m==g+1?g:v;v=Math.floor((g+m)/2),c.removeChild(u)}if(E=u.nextSibling,-1==d&&E&&f(E)){if(s.setEndPoint(n?"EndToStart":"EndToEnd",e),/[\r\n]/.test(E.data)){var R,C,N,E,y,$=s.duplicate(),T=$.text.replace(/\r\n/g,"\r").length;for(y=$.moveStart("character",T);-1==(d=$.compareEndPoints("StartToEnd",$));)y++,$.moveStart("character",1)}else y=s.text.length;N=new a(E,y)}else R=(r||!n)&&u.previousSibling,N=(C=(r||n)&&u.nextSibling)&&f(C)?new a(C,0):R&&f(R)?new a(R,R.data.length):new a(c,i.getNodeIndex(u));return i.removeNode(u),{boundaryPosition:N,nodeInfo:{nodeIndex:v,containerElement:c}}},h=function(e,t){var n,r,o,a,s=e.offset,l=i.getDocument(e.node),u=c(l).createTextRange(),d=f(e.node);return d?r=(n=e.node).parentNode:(n=s<(a=e.node.childNodes).length?a[s]:null,r=e.node),(o=l.createElement("span")).innerHTML="&#feff;",n?r.insertBefore(o,n):r.appendChild(o),u.moveToElementText(o),u.collapse(!t),r.removeChild(o),d&&u[t?"moveStart":"moveEnd"]("character",s),u};(r=function(e){this.textRange=e,this.refresh()}).prototype=new s(document),r.prototype.refresh=function(){var e,t,n,r,i=u(this.textRange);0==(r=this.textRange).compareEndPoints("StartToEnd",r)?t=e=d(this.textRange,i,!0,!0).boundaryPosition:(e=(n=d(this.textRange,i,!0,!1)).boundaryPosition,t=d(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(r);var g=function(e){if(e.collapsed)return h(new a(e.startContainer,e.startOffset),!0);var t=h(new a(e.startContainer,e.startOffset),!0),n=h(new a(e.endContainer,e.endOffset),!1),r=c(s.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(r.rangeToTextRange=g,r.prototype.toTextRange=function(){return g(this)},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var p,m=(p=Function)("return this;")();void 0===m.Range&&(m.Range=r),e.createNativeRange=function(e){return c(e=l(e,t,"createNativeRange")).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=l(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=l(e,t,"createRangyRange"),new s(e)},o.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),o.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;void 0===n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),N.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){e.config.checkSelectionRanges=!0;var n,r,i,o="boolean",a="number",s=e.dom,c=e.util,l=c.isHostMethod,f=e.DomRange,u=e.WrappedRange,d=e.DOMException,h=s.DomPosition,g=e.features,p="Control",m=s.getDocument,v=s.getBody,R=f.rangesEqual;function C(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function N(e,n){if(!e)return window;if(s.isWindow(e))return e;if(e instanceof G)return e.win;var r=s.getContentDocument(e,t,n);return s.getWindow(r)}function E(e){return N(e,"getDocSelection").document.selection}function y(e){var t=!1;return e.anchorNode&&(t=1==s.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}var $=l(window,"getSelection"),T=c.isHostObject(document,"selection");g.implementsWinGetSelection=$,g.implementsDocSelection=T;var S=T&&(!$||e.config.preferTextRange);if(S)B=E,e.isSelectionValid=function(e){var t=N(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||m(n.createRange().parentElement())==t};else{if(!$)return t.fail("Neither document.selection or window.getSelection() detected."),!1;B=function e(t){return N(t,"getWinSelection").getSelection()},e.isSelectionValid=function(){return!0}}e.getNativeSelection=B;var w=B();if(!w)return t.fail("Native selection was null (possibly issue 138?)"),!1;var _=e.createNativeRange(document),A=v(document),O=c.areHostProperties(w,["anchorNode","focusNode","anchorOffset","focusOffset"]);g.selectionHasAnchorAndFocus=O;var x=l(w,"extend");g.selectionHasExtend=x;var b=l(w,"setBaseAndExtent");g.selectionHasSetBaseAndExtent=b;var D=typeof w.rangeCount==a;g.selectionHasRangeCount=D;var P=!1,I=!0,H=x?function(t,n){var r=f.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(z(i)),t.extend(n.startContainer,n.startOffset)}:null;c.areHostMethods(w,["addRange","getRangeAt","removeAllRanges"])&&typeof w.rangeCount==a&&g.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=[],i=y(t),o=0;o<n;++o)r[o]=t.getRangeAt(o);var a=s.createTestElement(document,"",!1),c=a.appendChild(document.createTextNode("\xa0\xa0\xa0")),l=document.createRange();if(l.setStart(c,1),l.collapse(!0),t.removeAllRanges(),t.addRange(l),I=1==t.rangeCount,t.removeAllRanges(),!(n>1)){var f=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(f&&parseInt(f[1])>=36)P=!1;else{var u=l.cloneRange();l.setStart(c,0),u.setEnd(c,3),u.setStart(c,2),t.addRange(l),t.addRange(u),P=2==t.rangeCount}}for(s.removeNode(a),t.removeAllRanges(),o=0;o<n;++o)0==o&&i?H?H(t,r[o]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(r[o])):t.addRange(r[o])}}(),g.selectionSupportsMultipleRanges=P,g.collapsedNonEditableSelectionsSupported=I;var B,M,W,L=!1;function k(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function F(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0,j(e)}function j(e){e.type=0==e.rangeCount?"None":M(e)?"Caret":"Range"}function z(t){var n;return t instanceof f?((n=e.createNativeRange(t.getDocument())).setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof u?n=t.nativeRange:g.implementsDomRange&&t instanceof s.getWindow(t.startContainer).Range&&(n=t),n}function U(e){var n=e.getNodes();if(!function e(t){if(!t.length||1!=t[0].nodeType)return!1;for(var n=1,r=t.length;n<r;++n)if(!s.isAncestorOf(t[0],t[n]))return!1;return!0}(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function V(e){return!!e&&void 0!==e.text}function q(e,t){var n=new u(t);e._ranges=[n],k(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed,j(e)}function Y(t){if(t._ranges.length=0,"None"==t.docSelection.type)F(t);else{var n=t.docSelection.createRange();if(V(n))q(t,n);else{t.rangeCount=n.length;for(var r,i=m(n.item(0)),o=0;o<t.rangeCount;++o)(r=e.createRange(i)).selectNode(n.item(o)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,k(t,t._ranges[t.rangeCount-1],!1),j(t)}}}function Q(e,n){for(var r=e.docSelection.createRange(),i=U(n),o=m(r.item(0)),a=v(o).createControlRange(),s=0,c=r.length;s<c;++s)a.add(r.item(s));try{a.add(i)}catch(l){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),Y(e)}function G(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function X(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0,j(e)}A&&l(A,"createControlRange")&&(W=A.createControlRange(),c.areHostProperties(W,["item","add"])&&(L=!0)),g.implementsControlRange=L,M=O?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return!!e.rangeCount&&e.getRangeAt(e.rangeCount-1).collapsed},l(w,"getRangeAt")?n=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:O&&(n=function(t){var n=m(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),G.prototype=e.selectionPrototype;var Z=[];function J(e,t){for(var n,r,i=Z.length;i--;)if(r=(n=Z[i]).selection,"deleteAll"==t)X(r);else if(n.win==e){if("delete"==t)return Z.splice(i,1),!0;return r}return"deleteAll"==t&&(Z.length=0),null}var K=function(e){if(e&&e instanceof G)return e.refresh(),e;e=N(e,"getNativeSelection");var t=J(e),n=B(e),r=T?E(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh()):(t=new G(n,r,e),Z.push({win:e,selection:t})),t};e.getSelection=K,c.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var ee=G.prototype;function et(e,n){for(var r,i=m(n[0].startContainer),o=v(i).createControlRange(),a=0,s=n.length;a<s;++a){r=U(n[a]);try{o.add(r)}catch(c){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}o.select(),Y(e)}if(!S&&O&&c.areHostMethods(w,["removeAllRanges","addRange"])){ee.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),F(this)};var en=function(e,t){H(e.nativeSelection,t),e.refresh()};D?ee.addRange=function(t,r){if(L&&T&&this.docSelection.type==p)Q(this,t);else if(C(r)&&x)en(this,t);else{P?o=this.rangeCount:(this.removeAllRanges(),o=0);var o,a=z(t).cloneRange();try{this.nativeSelection.addRange(a)}catch(s){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var c=n(this.nativeSelection,this.rangeCount-1);c&&!R(c,t)&&(t=new u(c))}this._ranges[this.rangeCount-1]=t,k(this,t,i(this.nativeSelection)),this.isCollapsed=M(this),j(this)}else this.refresh()}}:ee.addRange=function(e,t){C(t)&&x?en(this,e):(this.nativeSelection.addRange(z(e)),this.refresh())},ee.setRanges=function(e){if(L&&T&&e.length>1)et(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;t<n;++t)this.addRange(e[t])}}}else{if(!(l(w,"empty")&&l(_,"select"))||!L||!S)return t.fail("No means of selecting a Range or TextRange was found"),!1;ee.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){if(this.anchorNode)e=m(this.anchorNode);else if(this.docSelection.type==p){var e,t=this.docSelection.createRange();t.length&&(e=m(t.item(0)))}e&&(v(e).createTextRange().select(),this.docSelection.empty())}}catch(n){}F(this)},ee.addRange=function(t){this.docSelection.type==p?Q(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,k(this,t,!1),j(this))},ee.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?et(this,e):t&&this.addRange(e[0])}}if(ee.getRangeAt=function(e){if(!(e<0)&&!(e>=this.rangeCount))return this._ranges[e].cloneRange();throw new d("INDEX_SIZE_ERR")},S)r=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=v(t.win.document).createTextRange()).collapse(!0),t.docSelection.type==p?Y(t):V(n)?q(t,n):F(t)};else if(l(w,"getRangeAt")&&typeof w.rangeCount==a)r=function(t){if(L&&T&&t.docSelection.type==p)Y(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;n<r;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));k(t,t._ranges[t.rangeCount-1],i(t.nativeSelection)),t.isCollapsed=M(t),j(t)}else F(t)};else{if(!O||typeof w.isCollapsed!=o||typeof _.collapsed!=o||!g.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;r=function(e){var t,r,i,o=e.nativeSelection;o.anchorNode?(i=n(o,0),e._ranges=[i],e.rangeCount=1,r=(t=e).nativeSelection,t.anchorNode=r.anchorNode,t.anchorOffset=r.anchorOffset,t.focusNode=r.focusNode,t.focusOffset=r.focusOffset,e.isCollapsed=M(e),j(e)):F(e)}}ee.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(r(this),e){var o=t.length;if(o!=this._ranges.length||this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;o--;)if(!R(t[o],this._ranges[o]))return!0;return!1}};var er=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;r<i;++r)R(t,n[r])||e.addRange(n[r]);e.rangeCount||F(e)};function ei(e,t){if(e.win.document!=m(t))throw new d("WRONG_DOCUMENT_ERR")}function eo(e,t){if(t<0||t>(s.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new d("INDEX_SIZE_ERR")}function ea(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0))["set"+(t?"Start":"End")](n,r):(i=e.createRange(this.win.document)).setStartAndEnd(n,r),this.setSingleRange(i,this.isBackward())}}function es(e){var t=[],n=new h(e.anchorNode,e.anchorOffset),r=new h(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if(void 0!==e.rangeCount)for(var o=0,a=e.rangeCount;o<a;++o)t[o]=f.inspect(e.getRangeAt(o));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}L&&T?ee.removeRange=function(e){if(this.docSelection.type==p){for(var t,n=this.docSelection.createRange(),r=U(e),i=m(n.item(0)),o=v(i).createControlRange(),a=!1,s=0,c=n.length;s<c;++s)(t=n.item(s))!==r||a?o.add(n.item(s)):a=!0;o.select(),Y(this)}else er(this,e)}:ee.removeRange=function(e){er(this,e)},!S&&O&&g.implementsDomRange?(i=y,ee.isBackward=function(){return i(this)}):i=ee.isBackward=function(){return!1},ee.isBackwards=ee.isBackward,ee.toString=function(){for(var e=[],t=0,n=this.rangeCount;t<n;++t)e[t]=""+this._ranges[t];return e.join("")},ee.collapse=function(t,n){ei(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},ee.collapseToStart=function(){if(this.rangeCount){var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)}else throw new d("INVALID_STATE_ERR")},ee.collapseToEnd=function(){if(this.rangeCount){var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)}else throw new d("INVALID_STATE_ERR")},ee.selectAllChildren=function(t){ei(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},b?ee.setBaseAndExtent=function(e,t,n,r){this.nativeSelection.setBaseAndExtent(e,t,n,r),this.refresh()}:x&&(ee.setBaseAndExtent=function(t,n,r,i){eo(t,n),eo(r,i),ei(this,t),ei(this,r);var o=e.createRange(node),a=-1==s.comparePoints(t,n,r,i);a?o.setStartAndEnd(r,i,t,n):o.setStartAndEnd(t,n,r,i),this.setSingleRange(o,a)}),ee.deleteFromDocument=function(){if(L&&T&&this.docSelection.type==p){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),s.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,i=n.length;r<i;++r)n[r].deleteContents();this.addRange(n[i-1])}}},ee.eachRange=function(e,t){for(var n=0,r=this._ranges.length;n<r;++n)if(e(this.getRangeAt(n)))return t},ee.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},ee.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},ee.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t||[]))}),n},ee.setStart=ea(!0),ee.setEnd=ea(!1),e.rangePrototype.select=function(e){K(this.getDocument()).setSingleRange(this,e)},ee.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},ee.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},ee.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},ee.moveToBookmark=function(t){for(var n,r,i=[],o=0;n=t.rangeBookmarks[o++];)(r=e.createRange(this.win)).moveToBookmark(n),i.push(r);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},ee.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ee.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},ee.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(f.toHtml(t))}),e.join("")},g.implementsTextRange&&(ee.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(V(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),ee.getName=function(){return"WrappedSelection"},ee.inspect=function(){return es(this)},ee.detach=function(){J(this.win,"delete"),X(this)},G.detachAll=function(){J(null,"deleteAll")},G.inspect=es,G.isDirectionBackward=C,e.Selection=G,e.selectionPrototype=ee,e.addShimListener(function(e){void 0===e.getSelection&&(e.getSelection=function(){return K(e)}),e=null})});var P=!1,I=function(e){P||(P=!0,!N.initialized&&N.config.autoInitialize&&w())};return R&&("complete"==document.readyState?I():(c(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",I,!1),t(window,"load",I))),N},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("ClassApplier",["WrappedSelection"],function(e,t){var n=e.dom,r=n.DomPosition,i=n.arrayContains,o=e.util,a=o.forEach,s=o.isHostMethod(document,"createElementNS");function c(e,t){for(var n in e)if(e.hasOwnProperty(n)&&!1===t(n,e[n]))return!1;return!0}function l(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function f(e,t){return!!e&&RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e)}function u(e,t){return"object"==typeof e.classList?e.classList.contains(t):f("string"==typeof e.className?e.className:e.getAttribute("class"),t)}function d(e,t){if("object"==typeof e.classList)e.classList.add(t);else{var n="string"==typeof e.className,r=n?e.className:e.getAttribute("class");r?f(r,t)||(r+=" "+t):r=t,n?e.className=r:e.setAttribute("class",r)}}var h=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){if("object"==typeof t.classList)t.classList.remove(n);else{var r="string"==typeof t.className,i=r?t.className:t.getAttribute("class");i=i.replace(RegExp("(^|\\s)"+n+"(\\s|$)"),e),r?t.className=i:t.setAttribute("class",i)}}}();function g(e){return"string"==typeof e.className?e.className:e.getAttribute("class")}function p(e){return e&&e.split(/\s+/).sort().join(" ")}function m(e){return p(g(e))}function v(e,t){return m(e)==m(t)}function R(e,t){for(var n=t.split(/\s+/),r=0,i=n.length;r<i;++r)if(!u(e,l(n[r])))return!1;return!0}function C(e,t,r,i){-1==r&&(r=t.childNodes.length);var o=e.parentNode,s=n.getNodeIndex(e);a(i,function(e){var n,i,a,c,l,f,u,d,h;n=e,i=o,a=s,c=t,l=r,f=n.node,u=n.offset,d=f,h=u,f==c&&u>l&&++h,f==i&&(u==a||u==a+1)&&(d=c,h+=l-a),f==i&&u>a+1&&--h,n.node=d,n.offset=h}),t.childNodes.length==r?t.appendChild(e):t.insertBefore(e,t.childNodes[r])}function N(e,t){var r=e.parentNode,i=n.getNodeIndex(e);a(t,function(e){var t,n,o;t=e,n=r,o=i,t.node==n&&t.offset>o&&--t.offset}),n.removeNode(e)}function E(e,t){return function e(t,n,r,i,o){for(var a,s=[];a=t.firstChild;)C(a,n,r++,o),s.push(a);return i&&N(t,o),s}(e,e.parentNode,n.getNodeIndex(e),!0,t)}function y(e,t){var n=e.cloneRange();n.selectNodeContents(t);var r=n.intersection(e);return""!=(r?r.toString():"")}function $(e){for(var t,n=e.getNodes([3]),r=0;(t=n[r])&&!y(e,t);)++r;for(var i=n.length-1;(t=n[i])&&!y(e,t);)--i;return n.slice(r,i+1)}function T(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,r,i,o=0,a=e.attributes.length;o<a;++o)if("class"!=(i=(n=e.attributes[o]).name)&&(null===n!=(null===(r=t.attributes.getNamedItem(i)))||n.specified!=r.specified||n.specified&&n.nodeValue!==r.nodeValue))return!1;return!0}function S(e,t){for(var n,r=0,o=e.attributes.length;r<o;++r)if(n=e.attributes[r].name,!(t&&i(t,n))&&e.attributes[r].specified&&"class"!=n)return!0;return!1}var w=n.getComputedStyleProperty,_="boolean"==typeof document.createElement("div").isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return!!e&&1==e.nodeType&&"false"!=e.contentEditable&&("true"==e.contentEditable||_(e.parentNode))};function A(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||_(e)&&!_(e.parentNode))}function O(e){return(_(e)||1!=e.nodeType&&_(e.parentNode))&&!A(e)}var x=/^inline(-block|-table)?$/i;function b(e){return e&&1==e.nodeType&&!x.test(w(e,"display"))}var D=/[^\r\n\t\f \u200B]/;function P(e){var t,n,i=[];for(t=0;n=e[t++];)i.push(new r(n.startContainer,n.startOffset),new r(n.endContainer,n.endOffset));return i}function I(e,t){for(var n,r,i,o=0,a=e.length;o<a;++o)n=e[o],r=t[2*o],i=t[2*o+1],n.setStartAndEnd(r.node,r.offset,i.node,i.offset)}function H(e,r,i,o){var a=0==i;if(n.isAncestorOf(r,e))return e;if(n.isCharacterDataNode(r)){var s=n.getNodeIndex(r);if(0==i)i=s;else if(i==r.length)i=s+1;else throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+r.data);r=r.parentNode}if(c=r,l=i,n.isCharacterDataNode(c)?0==l?!!c.previousSibling:l!=c.length||!!c.nextSibling:l>0&&l<c.childNodes.length){f=r.cloneNode(!1),u=r.parentNode,f.id&&f.removeAttribute("id");for(var c,l,f,u,d,h=0;d=r.childNodes[i];)C(d,f,h++,o);return C(f,u,n.getNodeIndex(r)+1,o),r==e?f:H(e,u,n.getNodeIndex(f),o)}if(e!=r){f=r.parentNode;var g=n.getNodeIndex(r);return!a&&g++,H(e,f,g,o)}return e}function B(e){var t=e?"nextSibling":"previousSibling";return function(n,r){var i,o,a=n.parentNode,s=n[t];if(s){if(s&&3==s.nodeType)return s}else if(r&&(s=a[t])&&1==s.nodeType&&(i=a,o=s,i.namespaceURI==o.namespaceURI&&i.tagName.toLowerCase()==o.tagName.toLowerCase()&&v(i,o)&&T(i,o)&&"inline"==w(i,"display")&&"inline"==w(o,"display"))){var c=s[e?"firstChild":"lastChild"];if(c&&3==c.nodeType)return c}return null}}var M=B(!1),W=B(!0);function L(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}L.prototype={doMerge:function(e){var t=this.textNodes,r=t[0];if(t.length>1){var i,o=n.getNodeIndex(r),s=[],c=0;a(t,function(l,f){i=l.parentNode,f>0&&(i.removeChild(l),i.hasChildNodes()||n.removeNode(i),e&&a(e,function(e){e.node==l&&(e.node=r,e.offset+=c),e.node==i&&e.offset>o&&(--e.offset,e.offset==o+1&&f<t.length-1&&(e.node=r,e.offset=c))})),s[f]=l.data,c+=l.data.length}),r.data=s.join("")}return r.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){var e=[];return a(this.textNodes,function(t,n){e[n]="'"+t.data+"'"}),"[Merge("+e.join(",")+")]"}};var k=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],F={};function j(e,t,n){var r,i,o,a,s=this;s.cssClass=s.className=e;var f=null,u={};if("object"==typeof t&&null!==t){for(void 0!==t.elementTagName&&(t.elementTagName=t.elementTagName.toLowerCase()),n=t.tagNames,f=t.elementProperties,u=t.elementAttributes,i=0;a=k[i++];)t.hasOwnProperty(a)&&(s[a]=t[a]);r=t.normalize}else r=t;s.normalize=void 0===r||r,s.attrExceptions=[];var d=document.createElement(s.elementTagName);s.elementProperties=s.copyPropertiesToElement(f,d,!0),c(u,function(e,t){s.attrExceptions.push(e),u[e]=""+t}),s.elementAttributes=u,s.elementSortedClassName=s.elementProperties.hasOwnProperty("className")?p(s.elementProperties.className+" "+e):e,s.applyToAnyTagName=!1;var h=typeof n;if("string"==h)"*"==n?s.applyToAnyTagName=!0:s.tagNames=l(n.toLowerCase()).split(/\s*,\s*/);else if("object"==h&&"number"==typeof n.length)for(i=0,s.tagNames=[],o=n.length;i<o;++i)"*"==n[i]?s.applyToAnyTagName=!0:s.tagNames.push(n[i].toLowerCase());else s.tagNames=[s.elementTagName]}j.prototype={elementTagName:"span",elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var r,i,o,a,s,c,l={};for(var f in e)if(e.hasOwnProperty(f)){if(a=e[f],s=t[f],"className"==f)d(t,a),d(t,this.className),t[f]=p(t[f]),n&&(l[f]=a);else if("style"==f){for(r in i=s,n&&(l[f]=o={}),e[f])e[f].hasOwnProperty(r)&&(i[r]=a[r],n&&(o[r]=i[r]));this.attrExceptions.push(f)}else t[f]=a,n&&(l[f]=t[f],c=F.hasOwnProperty(f)?F[f]:f,this.attrExceptions.push(c))}return n?l:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&!/^class(?:Name)?$/i.test(n)&&t.setAttribute(n,e[n])},appliesToElement:function(e){return i(this.tagNames,e.tagName.toLowerCase())},getEmptyElements:function(e){var t=this;return e.getNodes([1],function(e){return t.appliesToElement(e)&&!e.hasChildNodes()})},hasClass:function(e){return 1==e.nodeType&&(this.applyToAnyTagName||this.appliesToElement(e))&&u(e,this.className)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||O(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&function e(t){if(0==t.data.length)return!0;if(D.test(t.data))return!1;var n=w(t.parentNode,"whiteSpace");switch(n){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(t.data))return!1}return b(t.previousSibling)||b(t.nextSibling)}(e)},postApply:function(e,t,n,r){var i,o,s=e[0],c=e[e.length-1],l=[],f=s,u=c,d=0,h=c.length;a(e,function(e){(i=M(e,!r))?(o||(o=new L(i),l.push(o)),o.textNodes.push(e),e===s&&(d=(f=o.textNodes[0]).length),e===c&&(u=o.textNodes[0],h=o.getLength())):o=null});var g=W(c,!r);if(g&&(o||(o=new L(c),l.push(o)),o.textNodes.push(g)),l.length){for(var p=0,m=l.length;p<m;++p)l[p].doMerge(n);t.setStartAndEnd(f,d,u,h)}},createContainer:function(e){var t,r=n.getDocument(e),i=s&&!n.isHtmlNamespace(e)&&(t=e.namespaceURI)?r.createElementNS(e.namespaceURI,this.elementTagName):r.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,i,!1),this.copyAttributesToElement(this.elementAttributes,i),d(i,this.className),this.onElementCreate&&this.onElementCreate(i,this),i},elementHasProperties:function(e,t){var n=this;return c(t,function(t,r){if("className"==t)return R(e,r);if("object"==typeof r){if(!n.elementHasProperties(e[t],r))return!1}else if(e[t]!==r)return!1})},elementHasAttributes:function(e,t){return c(t,function(t,n){if(e.getAttribute(t)!==n)return!1})},applyToTextNode:function(e,t){var n,r;if((r=(n=e).parentNode)&&1==r.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(r.nodeName)){var i=e.parentNode;if(1==i.childNodes.length&&this.useExistingElements&&this.appliesToElement(i)&&this.elementHasProperties(i,this.elementProperties)&&this.elementHasAttributes(i,this.elementAttributes))d(i,this.className);else{var o=e.parentNode,a=this.createContainer(o);o.insertBefore(a,e),a.appendChild(e)}}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&m(e)==this.elementSortedClassName&&this.elementHasProperties(e,this.elementProperties)&&!S(e,this.attrExceptions)&&this.elementHasAttributes(e,this.elementAttributes)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){var t=this,n=e.getNodes([1],function(e){return t.isEmptyContainer(e)}),r=[e],i=P(r);a(n,function(e){N(e,i)}),I(r,i)},undoToTextNode:function(e,t,n,r){if(!t.containsNode(n)){var i=t.cloneRange();i.selectNode(n),i.isPointInRange(t.endContainer,t.endOffset)&&(H(n,t.endContainer,t.endOffset,r),t.setEndAfter(n)),i.isPointInRange(t.startContainer,t.startOffset)&&(n=H(n,t.startContainer,t.startOffset,r))}this.isRemovable(n)?E(n,r):h(n,this.className)},splitAncestorWithClass:function(e,t,n){var r=this.getSelfOrAncestorWithClass(e);r&&H(r,e,t,n)},undoToAncestor:function(e,t){this.isRemovable(e)?E(e,t):h(e,this.className)},applyToRange:function(e,t){var n=this;t=t||[];var r=P(t||[]);e.splitBoundariesPreservingPositions(r),n.removeEmptyElements&&n.removeEmptyContainers(e);var i=$(e);if(i.length){a(i,function(e){!n.isIgnorableWhiteSpaceNode(e)&&!n.getSelfOrAncestorWithClass(e)&&n.isModifiable(e)&&n.applyToTextNode(e,r)});var o=i[i.length-1];e.setStartAndEnd(i[0],0,o,o.length),n.normalize&&n.postApply(i,e,r,!1),I(t,r)}a(n.getEmptyElements(e),function(e){d(e,n.className)})},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){var n,r,i=this;t=t||[];var o=P(t);e.splitBoundariesPreservingPositions(o),i.removeEmptyElements&&i.removeEmptyContainers(e,o);var s=$(e),c=s[s.length-1];if(s.length){i.splitAncestorWithClass(e.endContainer,e.endOffset,o),i.splitAncestorWithClass(e.startContainer,e.startOffset,o);for(var l=0,f=s.length;l<f;++l)n=s[l],(r=i.getSelfOrAncestorWithClass(n))&&i.isModifiable(n)&&i.undoToAncestor(r,o);e.setStartAndEnd(s[0],0,c,c.length),i.normalize&&i.postApply(s,e,o,!0),I(t,o)}a(i.getEmptyElements(e),function(e){h(e,i.className)})},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),r=e.getSelection(t).getAllRanges();this.undoToRanges(r),n.setRanges(r)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length){for(var n,r=0;n=t[r++];)if(!this.isIgnorableWhiteSpaceNode(n)&&y(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1}return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var r=n.getSelfOrAncestorWithClass(e);r&&!i(t,r)&&t.push(r)}),t},detach:function(){}},j.util={hasClass:u,addClass:d,removeClass:h,getClass:g,hasSameClasses:v,hasAllClasses:R,replaceWithOwnChildren:E,elementsHaveSameNonClassAttributes:T,elementHasNonClassAttributes:S,splitNodeAt:H,isEditableElement:_,isEditingHost:A,isEditable:O},e.CssClassApplier=e.ClassApplier=j,e.createClassApplier=function e(t,n,r){return new j(t,n,r)},o.createAliasForDeprecatedMethod(e,"createCssClassApplier","createClassApplier",t)}),e},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("Highlighter",["ClassApplier"],function(e,t){var n=e.dom,r=n.arrayContains,i=n.getBody,o=e.util.createOptions,a=e.util.forEach,s=1;function c(e,t){return e.characterRange.start-t.characterRange.start}function l(e,t){return t?e.getElementById(t):i(e)}var f={};function u(e,t){this.type=e,this.converterCreator=t}function d(e,t){f[e]=new u(e,t)}function h(e){var t=f[e];if(t instanceof u)return t.create();throw Error("Highlighter type '"+e+"' is not valid")}function g(e,t){this.start=e,this.end=t}u.prototype.create=function(){var e=this.converterCreator();return e.type=this.type,e},e.registerHighlighterType=d,g.prototype={intersects:function(e){return this.start<e.end&&this.end>e.start},isContiguousWith:function(e){return this.start==e.end||this.end==e.start},union:function(e){return new g(Math.min(this.start,e.start),Math.max(this.end,e.end))},intersection:function(e){return new g(Math.max(this.start,e.start),Math.min(this.end,e.end))},getComplements:function(e){var t=[];if(this.start>=e.start){if(this.end<=e.end)return[];t.push(new g(e.end,this.end))}else t.push(new g(this.start,Math.min(this.end,e.start))),this.end>e.end&&t.push(new g(e.end,this.end));return t},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},g.fromCharacterRange=function(e){return new g(e.start,e.end)};var p,m={rangeToCharacterRange:function(e,t){var n=e.getBookmark(t);return new g(n.start,n.end)},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.moveToBookmark({start:n.start,end:n.end,containerNode:r}),i},serializeSelection:function(e,t){for(var n=e.getAllRanges(),r=n.length,i=[],o=1==r&&e.isBackward(),a=0,s=n.length;a<s;++a)i[a]={characterRange:this.rangeToCharacterRange(n[a],t),backward:o};return i},restoreSelection:function(e,t,n){e.removeAllRanges();for(var r,i,o,a=e.win.document,s=0,c=t.length;s<c;++s)o=(i=t[s]).characterRange,r=this.characterRangeToRange(a,i.characterRange,n),e.addRange(r,i.backward)}};function v(e,t,n,r,i,o){i?(this.id=i,s=Math.max(s,i+1)):this.id=s++,this.characterRange=t,this.doc=e,this.classApplier=n,this.converter=r,this.containerElementId=o||null,this.applied=!1}function R(e,t){t=t||"textContent",this.doc=e||document,this.classAppliers={},this.highlights=[],this.converter=h(t)}d("textContent",function(){return m}),d("TextRange",function(){if(!p){var t=e.modules.TextRange;if(t){if(!t.supported)throw Error("TextRange module is present but not supported.")}else throw Error("TextRange module is missing.");p={rangeToCharacterRange:function(e,t){return g.fromCharacterRange(e.toCharacterRange(t))},characterRangeToRange:function(t,n,r){var i=e.createRange(t);return i.selectCharacters(r,n.start,n.end),i},serializeSelection:function(e,t){return e.saveCharacterRanges(t)},restoreSelection:function(e,t,n){e.restoreCharacterRanges(n,t)}}}return p}),v.prototype={getContainerElement:function(){return l(this.doc,this.containerElementId)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(e){this.characterRange=this.converter.rangeToCharacterRange(e,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(e){return this.getRange().containsNodeContents(e.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.className+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}},R.prototype={addClassApplier:function(e){this.classAppliers[e.className]=e},getHighlightForElement:function(e){for(var t=this.highlights,n=0,r=t.length;n<r;++n)if(t[n].containsElement(e))return t[n];return null},removeHighlights:function(e){for(var t,n=0,i=this.highlights.length;n<i;++n)r(e,t=this.highlights[n])&&(t.unapply(),this.highlights.splice(n--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(e){var t=[],n=this.highlights;return a(e,function(e){a(n,function(n){e.intersectsRange(n.getRange())&&!r(t,n)&&t.push(n)})}),t},highlightCharacterRanges:function(t,n,r){var i,s,c,l,f,u,d,h,p,m,R,C,N=this.highlights,E=this.converter,y=this.doc,$=[],T=t?this.classAppliers[t]:null,S=(r=o(r,{containerElementId:null,exclusive:!0})).containerElementId,w=r.exclusive;for(S&&(l=this.doc.getElementById(S))&&((f=e.createRange(this.doc)).selectNodeContents(l),u=new g(0,f.toString().length)),i=0,s=n.length;i<s;++i)if(d=n[i],R=[],u&&(d=d.intersection(u)),d.start!=d.end){for(c=0;c<N.length;++c)p=!1,S==N[c].containerElementId&&(h=N[c].characterRange,C=!(m=T==N[c].classApplier)&&w,(h.intersects(d)||h.isContiguousWith(d))&&(m||C)&&(C&&a(h.getComplements(d),function(e){R.push(new v(y,e,N[c].classApplier,E,null,S))}),p=!0,m&&(d=h.union(d)))),p?($.push(N[c]),N[c]=new v(y,h.union(d),T,E,null,S)):R.push(N[c]);T&&R.push(new v(y,d,T,E,null,S)),this.highlights=N=R}a($,function(e){e.unapply()});var _=[];return a(N,function(e){e.applied||(e.apply(),_.push(e))}),_},highlightRanges:function(t,n,r){var s,c=[],l=this.converter,f=(r=o(r,{containerElement:null,exclusive:!0})).containerElement,u=f?f.id:null;return f&&(s=e.createRange(f)).selectNodeContents(f),a(n,function(e){var t=f?s.intersection(e):e;c.push(l.rangeToCharacterRange(t,f||i(e.getDocument())))}),this.highlightCharacterRanges(t,c,{containerElementId:u,exclusive:r.exclusive})},highlightSelection:function(t,n){var r=this.converter,i=!!t&&this.classAppliers[t],s=(n=o(n,{containerElementId:null,exclusive:!0})).containerElementId,c=n.exclusive,f=n.selection||e.getSelection(this.doc),u=l(f.win.document,s);if(!i&&!1!==t)throw Error("No class applier found for class '"+t+"'");var d=r.serializeSelection(f,u),h=[];a(d,function(e){h.push(g.fromCharacterRange(e.characterRange))});var p=this.highlightCharacterRanges(t,h,{containerElementId:s,exclusive:c});return r.restoreSelection(f,d,u),p},unhighlightSelection:function(t){t=t||e.getSelection(this.doc);var n=this.getIntersectingHighlights(t.getAllRanges());return this.removeHighlights(n),t.removeAllRanges(),n},getHighlightsInSelection:function(t){return t=t||e.getSelection(this.doc),this.getIntersectingHighlights(t.getAllRanges())},selectionOverlapsHighlight:function(e){return this.getHighlightsInSelection(e).length>0},serialize:function(e){var t,n,r,i,s=this,l=s.highlights;return l.sort(c),(r=(t=(e=o(e,{serializeHighlightText:!1,type:s.converter.type})).type)!=s.converter.type)&&(i=h(t)),n=["type:"+t],a(l,function(t){var o,a=t.characterRange;r&&(o=t.getContainerElement(),a=i.rangeToCharacterRange(s.converter.characterRangeToRange(s.doc,a,o),o));var c=[a.start,a.end,t.id,t.classApplier.className,t.containerElementId];e.serializeHighlightText&&c.push(t.getText()),n.push(c.join("$"))}),n.join("|")},deserialize:function(e){var t,n,r,i=e.split("|"),o=[],a=i[0],s=!1;if(a&&(t=/^type:(\w+)$/.exec(a)))(n=t[1])!=this.converter.type&&(r=h(n),s=!0),i.shift();else throw Error("Serialized highlights are invalid.");for(var c,f,u,d,p,m,R=i.length;R-- >0;){if(m=i[R].split("$"),u=new g(+m[0],+m[1]),d=m[4]||null,s&&(p=l(this.doc,d),u=this.converter.rangeToCharacterRange(r.characterRangeToRange(this.doc,u,p),p)),!(c=this.classAppliers[m[3]]))throw Error("No class applier found for class '"+m[3]+"'");(f=new v(this.doc,u,c,this.converter,parseInt(m[2]),d)).apply(),o.push(f)}this.highlights=o}},e.Highlighter=R,e.createHighlighter=function(e,t){return new R(e,t)}}),e},this);